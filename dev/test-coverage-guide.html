<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Testing and Coverage · CTBase.jl</title><meta name="title" content="Testing and Coverage · CTBase.jl"/><meta property="og:title" content="Testing and Coverage · CTBase.jl"/><meta property="twitter:title" content="Testing and Coverage · CTBase.jl"/><meta name="description" content="Documentation for CTBase.jl."/><meta property="og:description" content="Documentation for CTBase.jl."/><meta property="twitter:description" content="Documentation for CTBase.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script><link href="https://control-toolbox.org/assets/css/documentation.css" rel="stylesheet" type="text/css"/><script src="https://control-toolbox.org/assets/js/documentation.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">CTBase.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Developers Guide</span><ul><li class="is-active"><a class="tocitem" href="test-coverage-guide.html">Testing and Coverage</a><ul class="internal"><li><a class="tocitem" href="#Architecture-Overview"><span>Architecture Overview</span></a></li><li><a class="tocitem" href="#Setting-up-runtests.jl"><span>Setting up <code>runtests.jl</code></span></a></li><li><a class="tocitem" href="#Writing-Test-Files"><span>Writing Test Files</span></a></li><li><a class="tocitem" href="#Setting-up-Coverage"><span>Setting up Coverage</span></a></li><li><a class="tocitem" href="#Agent-Workflow-Integration"><span>Agent Workflow Integration</span></a></li></ul></li><li><a class="tocitem" href="documentation-guide.html">Documentation</a></li></ul></li><li><span class="tocitem">API Reference</span><ul><li><a class="tocitem" href="ctbase.html">CTBase</a></li><li><a class="tocitem" href="default.html">Default</a></li><li><a class="tocitem" href="description.html">Description</a></li><li><a class="tocitem" href="exception.html">Exception</a></li><li><a class="tocitem" href="utils.html">Utils</a></li><li><a class="tocitem" href="documenter_reference.html">DocumenterReference</a></li><li><a class="tocitem" href="coverage_postprocessing.html">CoveragePostprocessing</a></li><li><a class="tocitem" href="test_runner.html">TestRunner</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developers Guide</a></li><li class="is-active"><a href="test-coverage-guide.html">Testing and Coverage</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="test-coverage-guide.html">Testing and Coverage</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/control-toolbox/CTBase.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Developers-Guide"><a class="docs-heading-anchor" href="#Developers-Guide">Developers Guide</a><a id="Developers-Guide-1"></a><a class="docs-heading-anchor-permalink" href="#Developers-Guide" title="Permalink"></a></h1><p>This guide explains how to set up an advanced testing and coverage infrastructure for Julia packages. This setup is designed to be friendly both for human developers and AI agents, enabling granular test execution and feedback-driven development.</p><h2 id="Architecture-Overview"><a class="docs-heading-anchor" href="#Architecture-Overview">Architecture Overview</a><a id="Architecture-Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Architecture-Overview" title="Permalink"></a></h2><p>A robust testing architecture typically involves:</p><ol><li><strong>Test Runner</strong>: A <code>runtests.jl</code> file that allows running specific test groups via command-line arguments.</li><li><strong>Coverage Post-processing</strong>: A <code>coverage.jl</code> script that generates human-readable and machine-parseable coverage reports.</li><li><strong>Test Suite Structure</strong>: Modular test files, each containing a main entry point function.</li><li><strong>Agent Workflow</strong>: A standardized workflow definition (e.g., for LLM agents) to autonomously run tests and analyze coverage.</li></ol><h3 id="Recommended-Directory-Structure"><a class="docs-heading-anchor" href="#Recommended-Directory-Structure">Recommended Directory Structure</a><a id="Recommended-Directory-Structure-1"></a><a class="docs-heading-anchor-permalink" href="#Recommended-Directory-Structure" title="Permalink"></a></h3><p>We recommend placing your tests in a <code>suite</code> subdirectory to keep the top-level <code>test/</code> folder clean.</p><pre><code class="language-text hljs">MyPackage.jl/
├── .agent/
│   └── workflows/
│       └── test-julia.md    # Agent workflow definition
├── src/
│   └── ...
├── test/
│   ├── coverage.jl          # Coverage post-processing script
│   ├── runtests.jl          # Main test runner
│   └── suite/               # Directory containing test files
│       ├── test_utils.jl
│       ├── test_core.jl
│       └── ...
└── ...</code></pre><h2 id="Setting-up-runtests.jl"><a class="docs-heading-anchor" href="#Setting-up-runtests.jl">Setting up <code>runtests.jl</code></a><a id="Setting-up-runtests.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-runtests.jl" title="Permalink"></a></h2><p>The <code>runtests.jl</code> file is the entry point for your test suite. By using <code>CTBase.run_tests</code>, you enable a powerful mechanism to filter and execute specific tests using command-line arguments. This is crucial for fast iteration cycles.</p><h3 id="Example-test/runtests.jl"><a class="docs-heading-anchor" href="#Example-test/runtests.jl">Example <code>test/runtests.jl</code></a><a id="Example-test/runtests.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Example-test/runtests.jl" title="Permalink"></a></h3><pre><code class="language-julia hljs"># ==============================================================================
# MyPackage Test Runner
# ==============================================================================
#
# This test runner uses the CTBase TestRunner extension (triggered by `using Test`)
# to execute tests with configurable file/function name builders and optional
# test selection via command-line arguments.
#
# ## Running Tests
#
# ### Default (all available tests)
#
#   julia --project -e &#39;using Pkg; Pkg.test(&quot;MyPackage&quot;)&#39;
#
# ### Run a specific test group
#
#   julia --project -e &#39;using Pkg; Pkg.test(&quot;MyPackage&quot;; test_args=[&quot;utils&quot;])&#39;
#   julia --project -e &#39;using Pkg; Pkg.test(&quot;MyPackage&quot;; test_args=[&quot;core&quot;, &quot;utils&quot;])&#39;
#
# Note: 
# - Passing `-a` or `--all` is equivalent to running without arguments.
# - Passing `--dry-run` will print the list of tests that would be run, but not execute them.
#
# ## Coverage Mode
#
# Run tests with code coverage instrumentation:
#
#   julia --project -e &#39;
#       using Pkg; 
#       Pkg.test(&quot;MyPackage&quot;; coverage=true); 
#       include(&quot;test/coverage.jl&quot;)
#   &#39;
#
# This produces:
#   - coverage/lcov.info      — LCOV format for CI integration
#   - coverage/cov_report.md  — Human-readable summary with uncovered lines
#   - coverage/cov/           — Archived .cov files
#
# ## Test Groups
#
# Each test group corresponds to a file `test/suite/test_&lt;name&gt;.jl` that defines
# a function `test_&lt;name&gt;()`. The `available_tests` list below controls
# which groups are valid; requests for unlisted groups will error.
# ==============================================================================

# Load dependencies
using Test
using CTBase # Provides run_tests
using MyPackage # Your package

# Define where your tests are located
const TEST_DIR = @__DIR__

# Run tests using the CTBase test runner
CTBase.run_tests(;
    args=String.(ARGS),                 # Pass command line arguments
    testset_name=&quot;MyPackage Tests&quot;,     # Name of the main testset
    available_tests=[                   # List of available test groups/files
        &quot;suite/*&quot;                       # Use glob pattern to include all tests in suite/
    ],
    # Function to map a test name in ARGS (like &quot;utils&quot;) to a filename
    filename_builder = name -&gt; &quot;test_$(name).jl&quot;,
    # Function to map a test name in ARGS to the function to call inside that file
    funcname_builder = name -&gt; &quot;test_$(name)&quot;,
    test_dir=TEST_DIR,                  # Directory containing test files
    verbose=true,                       # Show verbose output
    showtiming=true,                    # Show timing information
)

# If running with coverage enabled, remind the user to run the post-processing script
if Base.JLOptions().code_coverage != 0
    println(
        &quot;&quot;&quot;
        ================================================================================
        Coverage files generated. To process them, please run:

            julia --project -e &#39;
                using Pkg; 
                Pkg.test(&quot;MyPackage&quot;; coverage=true); 
                include(&quot;test/coverage.jl&quot;)&#39;
            &#39;
        ================================================================================
        &quot;&quot;&quot;
    )
end</code></pre><h2 id="Writing-Test-Files"><a class="docs-heading-anchor" href="#Writing-Test-Files">Writing Test Files</a><a id="Writing-Test-Files-1"></a><a class="docs-heading-anchor-permalink" href="#Writing-Test-Files" title="Permalink"></a></h2><p>To support the modular execution model, each test file should define a function (typically matching the filename) that contains the tests. This avoids scope pollution and makes the tests easy to invoke programmatically.</p><h3 id="Example-test/suite/test_utils.jl"><a class="docs-heading-anchor" href="#Example-test/suite/test_utils.jl">Example <code>test/suite/test_utils.jl</code></a><a id="Example-test/suite/test_utils.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Example-test/suite/test_utils.jl" title="Permalink"></a></h3><pre><code class="language-julia hljs"># The function name matches the `funcname_builder` logic in runtests.jl
function test_utils()
    @testset &quot;Utilities&quot; begin
        @test MyPackage.add(1, 1) == 2
        @test MyPackage.sub(2, 1) == 1
    end
end</code></pre><h2 id="Setting-up-Coverage"><a class="docs-heading-anchor" href="#Setting-up-Coverage">Setting up Coverage</a><a id="Setting-up-Coverage-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-Coverage" title="Permalink"></a></h2><p>To generate actionable coverage reports, we use a dedicated <code>coverage.jl</code> script. This script processes the raw <code>.cov</code> files generated by Julia and produces summaries that are easy for an agent to read.</p><h3 id="Example-test/coverage.jl"><a class="docs-heading-anchor" href="#Example-test/coverage.jl">Example <code>test/coverage.jl</code></a><a id="Example-test/coverage.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Example-test/coverage.jl" title="Permalink"></a></h3><pre><code class="language-julia hljs"># Add the test directory to the load path so Julia can find dependencies from 
# test/Project.toml. This is necessary because this script is included from the 
# main project context, not from the test project context. Without this, Julia 
# won&#39;t find Coverage and other test-only dependencies.
pushfirst!(LOAD_PATH, @__DIR__)

using Pkg
using CTBase # Provides postprocess_coverage
using Coverage

# This function:
# 1. Aggregates coverage data.
# 2. Generates an LCOV file (coverage/lcov.info).
# 3. Generates a markdown summary (coverage/cov_report.md).
# 4. Archives used .cov files to keep the directory clean.
CTBase.postprocess_coverage(; 
    root_dir=dirname(@__DIR__) # Point to the package root
)</code></pre><h3 id="Running-with-Coverage"><a class="docs-heading-anchor" href="#Running-with-Coverage">Running with Coverage</a><a id="Running-with-Coverage-1"></a><a class="docs-heading-anchor-permalink" href="#Running-with-Coverage" title="Permalink"></a></h3><p>To run tests and generate the report:</p><pre><code class="language-bash hljs">julia --project -e &#39;
    using Pkg; 
    Pkg.test(&quot;MyPackage&quot;; coverage=true); 
    include(&quot;test/coverage.jl&quot;)
&#39;</code></pre><p>The resulting <code>coverage/cov_report.md</code> will contain a list of files with their coverage percentages and, crucially, a list of uncovered lines. This allows an agent to identify exactly which parts of the code need more tests.</p><h2 id="Agent-Workflow-Integration"><a class="docs-heading-anchor" href="#Agent-Workflow-Integration">Agent Workflow Integration</a><a id="Agent-Workflow-Integration-1"></a><a class="docs-heading-anchor-permalink" href="#Agent-Workflow-Integration" title="Permalink"></a></h2><p>To leverage LLM agents for testing, you can define a workflow that orchestrates these tools. The agent can:</p><ol><li>Run the full suite or specific tests.</li><li>Read the coverage report.</li><li>Write new tests to improve coverage.</li><li>Repeat.</li></ol><p>Create a file at <code>.agent/workflows/improve-coverage.md</code> (or similar path) to describe this process.</p><h3 id="Example-Workflow-Snippet"><a class="docs-heading-anchor" href="#Example-Workflow-Snippet">Example Workflow Snippet</a><a id="Example-Workflow-Snippet-1"></a><a class="docs-heading-anchor-permalink" href="#Example-Workflow-Snippet" title="Permalink"></a></h3><pre><code class="language-markdown hljs">---
description: Test and improve code coverage by analyzing coverage reports and writing targeted tests in Julia
---

# Julia Test &amp; Coverage Workflow

## Context
- **Run all tests**: `julia --project -e &#39;using Pkg; Pkg.test(&quot;MyPackage&quot;)&#39;`
- **Run specific test**: `julia --project -e &#39;using Pkg; Pkg.test(&quot;MyPackage&quot;; test_args=[&quot;core&quot;])&#39;`
- **Generate Coverage**: `julia --project -e &#39;using Pkg; Pkg.test(&quot;MyPackage&quot;; coverage=true); include(&quot;test/coverage.jl&quot;)&#39;`

## Workflow Steps

1. **Analyze**: Check current coverage by running the coverage command.
2. **Read Report**: Read `coverage/cov_report.md` to find files with low coverage.
3. **Plan**: Select a file to improve.
4. **Implement**:
   * Read the corresponding test file (e.g., `test/suite/test_core.jl`).
   * Add new test cases to the `test_core()` function.
5. **Verify**:
   * Run only the modified test group: `julia --project -e &#39;using Pkg; Pkg.test(&quot;MyPackage&quot;; test_args=[&quot;core&quot;])&#39;`
   * Ensure tests pass.
6. **Loop**: Re-run coverage to confirm improvement.</code></pre><p>This setup provides a closed-loop system where the agent has all the necessary tools to autonomously improve code quality.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="index.html">« Introduction</a><a class="docs-footer-nextpage" href="documentation-guide.html">Documentation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Tuesday 3 February 2026 20:27">Tuesday 3 February 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
